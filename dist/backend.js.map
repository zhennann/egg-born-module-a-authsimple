{"version":3,"sources":["webpack://backend/webpack/bootstrap","webpack://backend/external \"util\"","webpack://backend/./backend/src/main.js","webpack://backend/./backend/src/routes.js","webpack://backend/./backend/src/controller/version.js","webpack://backend/./backend/src/controller/auth.js","webpack://backend/./backend/src/services.js","webpack://backend/./backend/src/service/version.js","webpack://backend/./backend/src/service/auth.js","webpack://backend//Users/yangjian/Documents/data/cabloy/egg-born-demo/node_modules/password-hash-and-salt/index.js","webpack://backend//Users/yangjian/Documents/data/cabloy/egg-born-demo/node_modules/password-hash-and-salt/lib/hashsalt.js","webpack://backend/external \"crypto\"","webpack://backend/external \"require3\"","webpack://backend/./backend/src/models.js","webpack://backend/./backend/src/model/auth.js","webpack://backend/./backend/src/model/authSimple.js","webpack://backend/./backend/src/config/config.js","webpack://backend/./backend/src/config/locales.js","webpack://backend/./backend/src/config/locale/en-us.js","webpack://backend/./backend/src/config/locale/zh-cn.js","webpack://backend/./backend/src/config/errors.js","webpack://backend/./backend/src/meta.js","webpack://backend/./backend/src/config/passport/auth.js","webpack://backend/./backend/src/config/passport/strategy.js","webpack://backend//Users/yangjian/Documents/data/cabloy/egg-born-demo/node_modules/passport-strategy/lib/index.js","webpack://backend//Users/yangjian/Documents/data/cabloy/egg-born-demo/node_modules/passport-strategy/lib/strategy.js","webpack://backend/./backend/src/config/validation/keywords.js","webpack://backend/./backend/src/config/validation/schemas.js"],"names":[],"mappings":"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;AAEA;AACA,0DAA0D,qBAAqB;AAC/E;;AAEA;AACA;AACA;AACA,8CAA8C,SAAS;AACvD;AACA,8CAA8C,2BAA2B;;AAEzE;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,iBAAiB,uCAAuC;AACxD,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,kBAAkB,6BAA6B;AAC/C;AACA;AACA;AACA,eAAe,6BAA6B;AAC5C,OAAO;AACP;AACA;;AAEA,0BAA0B,WAAW;AACrC;AACA;AACA,6CAA6C,WAAW;AACxD;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA,eAAe,mBAAmB;AAClC;AACA,sDAAsD,WAAW;AACjE;AACA,8CAA8C,2BAA2B;;AAEzE;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA,kBAAkB,mBAAmB;AACrC;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,8CAA8C,kCAAkC;AAChF;AACA;AACA;AACA;;AAEA,0BAA0B,mCAAmC;AAC7D;AACA,4CAA4C,gCAAgC;AAC5E;AACA;AACA,mCAAmC,sBAAsB;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA,0DAA0D,kCAAkC;AAC5F;AACA;AACA;AACA;AACA;;AAEA,4BAA4B,sBAAsB;AAClD;AACA;AACA;AACA,OAAO;AACP,6CAA6C,wBAAwB;AACrE;AACA;AACA;AACA,OAAO;AACP;;AAEA,yBAAyB,qBAAqB;AAC9C;AACA,wCAAwC,MAAM;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mCAAmC,sBAAsB;AACzD;AACA;AACA;AACA,iDAAiD,aAAa;AAC9D,uCAAuC,6DAA6D;AACpG;AACA;AACA;;AAEA,0BAA0B,QAAQ;AAClC;AACA,oDAAoD,QAAQ;AAC5D;AACA;AACA,6FAA6F,MAAM;AACnG;AACA;AACA;AACA;AACA,6DAA6D,oCAAoC;AACjG;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,yBAAyB,MAAM;AAC/B,SAAS,kBAAkB;AAC3B;AACA;AACA;;AAEA,wBAAwB,cAAc;AACtC;AACA;AACA,eAAe,wCAAwC;AACvD,OAAO;AACP;AACA;AACA,uGAAuG,MAAM;AAC7G;AACA;AACA;AACA;AACA,6DAA6D,oCAAoC;AACjG;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA,wBAAwB,MAAM;AAC9B,SAAS,kBAAkB;AAC3B;AACA;AACA;;AAEA;AACA,6BAA6B,QAAQ;AACrC;AACA,uCAAuC,MAAM;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,OAAO;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,gCAAgC;AAC/C,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,OAAO;AACzD;AACA;;AAEA,yBAAyB,WAAW;AACpC;AACA;AACA;AACA;;AAEA,2BAA2B,iBAAiB;AAC5C;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;AC/Sa;;AAEb,iBAAiB,mBAAO,CAAC,CAAmB,E;;;;;;;ACF/B;;AAEb,aAAa,mBAAO,CAAC,EAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,E;AACL,IAAI;AACJ;AACA,I;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,+C;AACA,IAAI,E;AACJ;AACA;AACA;;;AAGA;;;;;;;AClEA,mC;;;;;;ACAA,qC;;;;;;ACAA,aAAa,mBAAO,CAAC,EAAiB;AACtC,mBAAmB,mBAAO,CAAC,EAAuB;;AAElD;AACA;AACA;AACA;;;;;;;ACNA;;AAEA;;AAEA;AACA,kBAAkB,2BAA2B,uBAAuB,EAAE;AACtE;;AAEA;;AAEA;AACA;;;;;;;ACXA;;AAEA;;AAEA;AACA,kBAAkB,iCAAiC,uBAAuB,EAAE;AAC5E;;AAEA;;AAEA;AACA;;;;;;;ACXA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV,KAAK;AACL;;AAEA;AACA;;;;;;;AC1CA;AACA,WAAW,mBAAO,CAAC,EAAmB;AACtC,WAAW,mBAAO,CAAC,EAAmB;AACtC;;;;;;;ACHA;AACA;AACA,oCAAoC,UAAU;AAC9C;AACA;AACA;AACA,KAAK,UAAU;;AAEf;;AAEA,EAAE;;AAEF;AACA,EAAE,UAAU;AACZ;;AAEA;AACA;AACA,wDAAwD,UAAU;AAClE;AACA;AACA;AACA,KAAK,UAAU;;AAEf;;AAEA,EAAE;;AAEF;AACA,EAAE,UAAU;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACzCA;AACA;AACA,oCAAoC,UAAU;AAC9C;AACA;AACA;AACA,KAAK,UAAU;;AAEf;;AAEA,EAAE;;AAEF;AACA,EAAE,UAAU;AACZ;;AAEA;AACA;AACA,qCAAqC,UAAU;AAC/C;AACA;AACA;AACA,KAAK,UAAU;;AAEf;;AAEA,EAAE;;AAEF;AACA,EAAE,UAAU;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACLA;AACA;AACA,eAAe,mBAAO,CAAC,EAA2B;AAClD;AACA,mBAAmB,mBAAO,CAAC,EAAiC;AAC5D;AACA,kBAAkB,mBAAO,CAAC,EAAgC;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;;;;;;AC5CA,iBAAiB,mBAAO,CAAC,EAAe;AACxC;AACA;AACA;AACA;AACA,WAAW,6BAA6B;AACxC;AACA,wCAAwC,kCAAkC;AAC1E;AACA,6CAA6C,4CAA4C;AACzF;AACA;AACA;AACA;AACA,sDAAsD,4BAA4B;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,gBAAgB,WAAW,EAAE;AAC5C,aAAa;AACb;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;;;;;;;ACnDA,iBAAiB,mBAAO,CAAC,EAAmB;AAC5C,aAAa,mBAAO,CAAC,CAAM;;AAE3B;AACA;AACA;AACA;AACA;AACA,gBAAgB,iEAAiE;;AAEjF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,IAAI,YAAY,uCAAuC;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,wBAAwB;AACtC,gBAAgB,wBAAwB;AACxC;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;;;;;;;AC3DA;AACA;AACA;AACA,eAAe,mBAAO,CAAC,EAAY;;;AAGnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,eAAe;AAC/D;AACA,2BAA2B,uEAAuE;AAClG;AACA;AACA;AACA,2BAA2B,0EAA0E;AACrG;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,eAAe;AAC/D;AACA,2BAA2B,kGAAkG;AAC7H;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,sBAAsB;AACtC,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,yBAAyB;AACzC,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,yBAAyB;AACzC,OAAO;AACP,KAAK;AACL;AACA;AACA","file":"backend.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"util\");","const routes = require('./routes.js');\nconst services = require('./services.js');\nconst models = require('./models.js');\nconst config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\nconst metaFn = require('./meta.js');\n\nmodule.exports = app => {\n  return {\n    routes,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    meta: metaFn(app),\n  };\n};\n","const version = require('./controller/version.js');\nconst auth = require('./controller/auth.js');\n\nmodule.exports = [\n  { method: 'post', path: 'version/update', controller: version, middlewares: 'inner' },\n  { method: 'post', path: 'version/init', controller: version, middlewares: 'inner' },\n  { method: 'post', path: 'version/test', controller: version, middlewares: 'test' },\n  { method: 'post', path: 'auth/add', controller: auth, middlewares: 'inner', meta: { auth: { enable: false } } },\n  { method: 'post', path: 'auth/signin', controller: auth, middlewares: 'captchaVerify',\n    meta: {\n      captchaVerify: { scene: { name: 'signin' } },\n    },\n  },\n  { method: 'post', path: 'auth/signup', controller: auth, middlewares: 'captchaVerify,validate',\n    meta: {\n      captchaVerify: { scene: { name: 'signup' } },\n      validate: { validator: 'signup' },\n    },\n  },\n  { method: 'post', path: 'auth/passwordChange', controller: auth, middlewares: 'captchaVerify,validate',\n    meta: {\n      captchaVerify: { scene: { name: 'passwordChange' } },\n      validate: { validator: 'passwordChange' },\n    },\n  },\n  { method: 'post', path: 'auth/passwordForgot', controller: auth, middlewares: 'validate,mail',\n    meta: { validate: { validator: 'passwordForgot' } },\n  },\n  { method: 'post', path: 'auth/passwordReset', controller: auth, middlewares: 'validate',\n    meta: { validate: { validator: 'passwordReset' } },\n  },\n  { method: 'post', path: 'auth/emailConfirm', controller: auth, middlewares: 'validate,mail',\n    meta: { validate: { validator: 'emailConfirm' } },\n  },\n  { method: 'get', path: 'auth/emailConfirmation', controller: auth },\n\n];\n","module.exports = app => {\n  class VersionController extends app.Controller {\n\n    async update() {\n      await this.service.version.update(this.ctx.request.body);\n      this.ctx.success();\n    }\n\n    async init() {\n      await this.service.version.init(this.ctx.request.body);\n      this.ctx.success();\n    }\n\n    async test() {\n      await this.service.version.test(this.ctx.request.body);\n      this.ctx.success();\n    }\n\n  }\n  return VersionController;\n};\n","module.exports = app => {\n  class AuthController extends app.Controller {\n\n    async add() {\n      const { userId, password } = this.ctx.request.body;\n      await this.service.auth.add({ userId, password });\n      this.ctx.success();\n    }\n\n    async signin() {\n      const { auth, password, rememberMe } = this.ctx.request.body.data;\n      const res = await this.service.auth.signin({ auth, password, rememberMe });\n      this.ctx.success(res);\n    }\n\n    async signup() {\n      const { userName, realName, email, mobile, password } = this.ctx.request.body.data;\n      const state = this.ctx.request.body.state;\n      const res = await this.service.auth.signup({\n        user: this.ctx.user.agent,\n        state,\n        userName, realName, email, mobile, password,\n      });\n      this.ctx.success(res);\n    }\n\n    async passwordChange() {\n      const { passwordOld, passwordNew } = this.ctx.request.body.data;\n      await this.service.auth.passwordChange({ passwordOld, passwordNew, userId: this.ctx.user.agent.id });\n      this.ctx.success();\n    }\n\n    async passwordForgot() {\n      const { email } = this.ctx.request.body.data;\n      await this.service.auth.passwordForgot({ email });\n      this.ctx.success();\n    }\n\n    async passwordReset() {\n      const { passwordNew } = this.ctx.request.body.data;\n      const token = this.ctx.request.body.token;\n      await this.service.auth.passwordReset({ passwordNew, token });\n      this.ctx.success();\n    }\n\n    async emailConfirm() {\n      const { email } = this.ctx.request.body.data;\n      await this.service.auth.emailConfirm({ email, user: this.ctx.user.agent });\n      this.ctx.success();\n    }\n\n    async emailConfirmation() {\n      const token = this.ctx.request.query.token;\n      await this.service.auth.emailConfirmation({ token });\n      // this.ctx.success();\n    }\n\n\n  }\n  return AuthController;\n};\n","const version = require('./service/version.js');\nconst auth = require('./service/auth.js');\nmodule.exports = {\n  version,\n  auth,\n};\n","module.exports = app => {\n  class Version extends app.Service {\n\n    async update(options) {\n      if (options.version === 1) {\n        // create table: aStatus\n        const sql = `\n          CREATE TABLE aAuthSimple (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            userId int(11) DEFAULT '0',\n            hash text DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n      }\n    }\n\n    async init(options) {\n      if (options.version === 1) {\n        // root\n        const user = await this.ctx.meta.user.get({ userName: 'root' });\n        await this.ctx.service.auth.add({\n          userId: user.id,\n          password: options.password,\n        });\n      }\n    }\n\n    async test() {\n\n    }\n\n  }\n\n  return Version;\n};\n","const util = require('util');\nconst passwordFn = require('password-hash-and-salt'); // should compile\nconst require3 = require('require3');\nconst uuid = require3('uuid');\n\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Auth extends app.Service {\n\n    // mobile: not use\n    async signup({ user, state = 'login', userName, realName, email, mobile, password }) {\n\n      // add authsimple\n      const authSimpleId = await this._addAuthSimple({ password });\n\n      // profileUser\n      const profileUser = {\n        module: moduleInfo.relativeName,\n        provider: 'authsimple',\n        profileId: authSimpleId,\n        maxAge: 0,\n        profile: {\n          authSimpleId,\n          rememberMe: false,\n        },\n      };\n\n      // verify\n      const verifyUser = await this.ctx.meta.user.verify({ state, profileUser });\n      if (!verifyUser) this.ctx.throw(403);\n\n      // userId\n      const userId = verifyUser.agent.id;\n      // remove old records\n      await this.ctx.model.authSimple.delete({ userId });\n      // update userId\n      await this.ctx.model.authSimple.update({ id: authSimpleId, userId });\n\n      // override user's info: userName/realName/email\n      const userNew = { id: userId, realName };\n      if (state === 'login' || !user.userName || user.userName.indexOf('__') > -1) {\n        userNew.userName = userName;\n      }\n      await this.ctx.meta.user.save({\n        user: userNew,\n      });\n      // save email\n      if (email !== verifyUser.agent.email) {\n        await this.ctx.meta.user.setActivated({\n          user: { id: userId, email, emailConfirmed: 0 },\n        });\n      }\n\n      // login now\n      //   always no matter login/associate\n      await this.ctx.login(verifyUser);\n\n      // ok\n      return verifyUser;\n    }\n\n    async signin({ auth, password, rememberMe }) {\n      const res = await this.ctx.performAction({\n        method: 'post',\n        url: 'passport/a-authsimple/authsimple',\n        body: { auth, password, rememberMe },\n      });\n      return res;\n    }\n\n    async _addAuthSimple({ password }) {\n      // hash\n      password = password || this.ctx.config.defaultPassword;\n      const hash = await this._calcPassword({ password });\n      // auth simple\n      const res = await this.ctx.model.authSimple.insert({\n        userId: 0,\n        hash,\n      });\n      return res.insertId;\n    }\n\n    async add({ userId, password }) {\n      // add authsimple\n      const authSimpleId = await this._addAuthSimple({ password });\n      // update userId\n      await this.ctx.model.authSimple.update({ id: authSimpleId, userId });\n\n      // auth\n      const providerItem = await this.ctx.meta.user.getAuthProvider({\n        module: moduleInfo.relativeName,\n        providerName: 'authsimple',\n      });\n      await this.ctx.model.auth.insert({\n        userId,\n        providerId: providerItem.id,\n        profileId: authSimpleId,\n        profile: JSON.stringify({\n          authSimpleId,\n          rememberMe: false,\n        }),\n      });\n    }\n\n    async verify({ userId, password }) {\n      // check\n      if (!password) return false;\n      // authSimple\n      const authSimple = await this.ctx.model.authSimple.get({\n        userId,\n      });\n      if (!authSimple) return false;\n      // verify\n      const res = await this._verifyPassword({ password, hash: authSimple.hash });\n      if (!res) return false;\n      // ok\n      return authSimple;\n    }\n\n    async passwordChange({ passwordOld, passwordNew, userId }) {\n      // verify old\n      const authSimple = await this.verify({ userId, password: passwordOld });\n      if (!authSimple) this.ctx.throw(403);\n      // save new\n      await this._passwordSaveNew({ passwordNew, userId });\n\n      // profileUser\n      const authSimpleId = authSimple.id;\n      const profileUser = {\n        module: moduleInfo.relativeName,\n        provider: 'authsimple',\n        profileId: authSimpleId,\n        maxAge: 0,\n        profile: {\n          authSimpleId,\n          rememberMe: false,\n        },\n      };\n\n      // verify\n      const verifyUser = await this.ctx.meta.user.verify({ state: 'associate', profileUser });\n      if (!verifyUser) this.ctx.throw(403);\n      // login now\n      //   always no matter login/associate\n      // await this.ctx.login(verifyUser);\n    }\n\n    async _passwordSaveNew({ passwordNew, userId }) {\n      // save new\n      const auth = await this.ctx.model.authSimple.get({\n        userId,\n      });\n      const hash = await this._calcPassword({ password: passwordNew });\n      await this.ctx.model.authSimple.update({\n        id: auth.id,\n        hash,\n      });\n    }\n\n    async passwordReset({ passwordNew, token }) {\n      // token value\n      const cacheKey = `passwordReset:${token}`;\n      const value = await this.ctx.cache.db.get(cacheKey);\n      if (!value) {\n        // expired, send confirmation mail again\n        //  1003: passwordResetEmailExpired\n        this.ctx.throw(1003);\n      }\n      // userId\n      const userId = value.userId;\n\n      // save new\n      await this._passwordSaveNew({ passwordNew, userId });\n      // clear token\n      await this.ctx.cache.db.remove(cacheKey);\n      // login antomatically\n      const user = await this.ctx.meta.user.get({ id: userId });\n      const user2 = await this.signin({ auth: user.email, password: passwordNew, rememberMe: false });\n      // ok\n      return user2;\n    }\n\n    async passwordForgot({ email }) {\n      // user by email\n      const user = await this.ctx.meta.user.exists({ email });\n      // link\n      const token = uuid.v4().replace(/-/g, '');\n      const link = this.ctx.meta.base.getAbsoluteUrl(`/#!/a/authsimple/passwordReset?token=${token}`);\n      // email scene\n      const scene = (app.meta.isTest || app.meta.isLocal) ? 'test' : 'system';\n      // email subject\n      let subject = this.ctx.text('passwordResetEmailSubject');\n      subject = this.ctx.meta.util.replaceTemplate(subject, { siteName: this.ctx.instance.title });\n      // email body\n      let body = this.ctx.text('passwordResetEmailBody');\n      body = this.ctx.meta.util.replaceTemplate(body, {\n        userName: user.userName,\n        link,\n        siteName: this.ctx.instance.title,\n      });\n      // send\n      await this.ctx.meta.mail.send({\n        scene,\n        message: {\n          to: email,\n          subject,\n          text: body,\n        },\n      });\n      // save\n      await this.ctx.cache.db.set(\n        `passwordReset:${token}`,\n        { userId: user.id },\n        this.ctx.config.passwordReset.timeout\n      );\n    }\n\n    async emailConfirm({ email, user }) {\n      // save email\n      await this.ctx.meta.user.setActivated({\n        user: { id: user.id, email, emailConfirmed: 0 },\n      });\n      // link\n      const token = uuid.v4().replace(/-/g, '');\n      const link = this.ctx.meta.base.getAbsoluteUrl(`/api/a/authsimple/auth/emailConfirmation?token=${token}`);\n      // email scene\n      const scene = (app.meta.isTest || app.meta.isLocal) ? 'test' : 'system';\n      // email subject\n      let subject = this.ctx.text('confirmationEmailSubject');\n      subject = this.ctx.meta.util.replaceTemplate(subject, { siteName: this.ctx.instance.title });\n      // email body\n      let body = this.ctx.text('confirmationEmailBody');\n      body = this.ctx.meta.util.replaceTemplate(body, {\n        userName: user.userName,\n        link,\n        siteName: this.ctx.instance.title,\n      });\n      // send\n      await this.ctx.meta.mail.send({\n        scene,\n        message: {\n          to: email,\n          subject,\n          text: body,\n        },\n      });\n      // save\n      await this.ctx.cache.db.set(\n        `emailConfirm:${token}`,\n        { userId: user.id },\n        this.ctx.config.confirmation.timeout\n      );\n    }\n\n    // invoke by user clicking the link\n    async emailConfirmation({ token }) {\n      // token value\n      const cacheKey = `emailConfirm:${token}`;\n      const value = await this.ctx.cache.db.get(cacheKey);\n      if (!value) {\n        // expired, send confirmation mail again\n        const data = {\n          message: this.ctx.text('confirmationEmailExpired'),\n          link: '/a/authsimple/emailConfirm',\n          linkText: this.ctx.text('Resend Confirmation Email'),\n        };\n        const url = this.ctx.meta.base.getAlertUrl({ data });\n        return this.ctx.redirect(url);\n      }\n      // userId\n      const userId = value.userId;\n      // activated\n      await this.ctx.meta.user.setActivated({\n        user: { id: userId, emailConfirmed: 1 },\n      });\n      // clear token\n      await this.ctx.cache.db.remove(cacheKey);\n      // not: login antomatically\n      // ok\n      const data = {\n        message: this.ctx.text('confirmationEmailSucceeded'),\n        link: '#back',\n        linkText: this.ctx.text('Close'),\n      };\n      const url = this.ctx.meta.base.getAlertUrl({ data });\n      return this.ctx.redirect(url);\n    }\n\n    async _calcPassword({ password }) {\n      const _password = passwordFn(password.toString());\n      const hashFn = util.promisify(_password.hash);\n      return await hashFn.call(_password);\n    }\n\n    async _verifyPassword({ password, hash }) {\n      const _password = passwordFn(password.toString());\n      const verifyFn = util.promisify(_password.verifyAgainst);\n      return await verifyFn.call(_password, hash);\n    }\n\n  }\n\n  return Auth;\n};\n","'use strict';\n\nmodule.exports = require('./lib/hashsalt.js');","'use strict';\n\nvar crypto = require('crypto');\n\nvar iterations = 10000;\nvar password = function(password) {\n\treturn {\n\t\thash: function(salt, callback) {\n\t\t\t// Make salt optional\n\t\t\tif(callback === undefined && salt instanceof Function) {\n\t\t\t\tcallback = salt;\n\t\t\t\tsalt = undefined;\n\t\t\t}\n\n\t\t\tif(!password) {\n\t\t\t\treturn callback('No password provided')\n\t\t\t}\n\n\t\t\tif(typeof salt === 'string') {\n\t\t\t\tsalt = new Buffer(salt, 'hex');\n\t\t\t}\n\n\t\t\tvar calcHash = function() {\n\t\t\t\tcrypto.pbkdf2(password, salt, iterations, 64, 'sha1', function(err, key) {\n\t\t\t\t\tif(err)\n\t\t\t\t\t\treturn callback(err);\n\t\t\t\t\tvar res = 'pbkdf2$' + iterations + \n\t\t\t\t\t\t\t\t'$' + key.toString('hex') + \n\t\t\t\t\t\t\t\t'$' + salt.toString('hex');\n\t\t\t\t\tcallback(null, res);\n\t\t\t\t})\t\t\n\t\t\t};\n\n\t\t\tif(!salt) {\n\t\t\t\tcrypto.randomBytes(64, function(err, gensalt) {\n\t\t\t\t\tif(err)\n\t\t\t\t\t\treturn callback(err);\n\t\t\t\t\tsalt = gensalt;\n\t\t\t\t\tcalcHash();\n\t\t\t\t});\t\t\n\t\t\t} else {\n\t\t\t\tcalcHash();\n\t\t\t}\t\t\t\n\t\t},\n\n\t\tverifyAgainst: function(hashedPassword, callback) {\n\t\t\tif(!hashedPassword || !password)\n\t\t\t\treturn callback(null, false);\n\n\t\t\tvar key = hashedPassword.split('$');\n\t\t\tif(key.length !== 4 || !key[2] || !key[3])\n\t\t\t\treturn callback('Hash not formatted correctly');\n\n\t\t\tif(key[0] !== 'pbkdf2' || key[1] !== iterations.toString())\n\t\t\t\treturn callback('Wrong algorithm and/or iterations');\n\n\t\t\tthis.hash(key[3], function(error, newHash) {\n\t\t\t\tif(error)\n\t\t\t\t\treturn callback(error);\n\t\t\t\tcallback(null, newHash === hashedPassword);\t\t\t\t\n\t\t\t});\t\n\t\t}\n\t};\n}\n\n\nmodule.exports = password;\n","module.exports = require(\"crypto\");","module.exports = require(\"require3\");","const auth = require('./model/auth.js');\nconst authSimple = require('./model/authSimple.js');\n\nmodule.exports = {\n  auth,\n  authSimple,\n};\n","module.exports = app => {\n\n  class Auth extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAuth', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return Auth;\n};\n","module.exports = app => {\n\n  class AuthSimple extends app.meta.Model {\n\n    constructor(ctx) {\n      super(ctx, { table: 'aAuthSimple', options: { disableDeleted: true } });\n    }\n\n  }\n\n  return AuthSimple;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {\n  };\n\n  // defaultPassword\n  config.defaultPassword = '123456';\n\n  // confirmation\n  config.confirmation = {\n    timeout: 2 * 24 * 60 * 60 * 1000, // 2 days\n  };\n\n  // passwordReset\n  config.passwordReset = {\n    timeout: 30 * 60 * 1000, // 30 minutes\n  };\n\n  // account\n  config.account = {\n    url: {\n      emailConfirm: '/a/authsimple/emailConfirm',\n      passwordChange: '/a/authsimple/passwordChange',\n      passwordForgot: '/a/authsimple/passwordForgot',\n      passwordReset: '/a/authsimple/passwordReset',\n    },\n  };\n\n  // captcha scenes\n  config.captcha = {\n    scenes: {\n      passwordChange: null,\n      signup: null,\n      signin: null, // means using default\n      // signin: {\n      //   module: 'a-captchasimple',\n      //   name: 'captcha',\n      // },\n    },\n  };\n\n  return config;\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","// confirmationEmail\n//   subject\nconst confirmationEmailSubject = '{{siteName}} Account Confirmation';\n//   body\nconst confirmationEmailBody =\n`\nHi {{userName}},\n\nWelcome to join us. Please click this link to confirm your email:\n\n{{link}}\n\nRegards,\n{{siteName}} Team\n`;\n\n// passwordResetEmail\n//   subject\nconst passwordResetEmailSubject = 'Password Reset for {{siteName}}';\n//   body\nconst passwordResetEmailBody =\n`\nHi {{userName}},\n\nTo reset your password, visit the following address:\n\n{{link}}\n\nRegards,\n{{siteName}} Team\n`;\n\n//\nmodule.exports = {\n  confirmationEmailExpired: 'This email confirmation link has expired',\n  confirmationEmailSucceeded: 'Your email address has been confirmed',\n  confirmationEmailSubject,\n  confirmationEmailBody,\n  passwordResetEmailExpired: 'This password reset link has expired',\n  passwordResetEmailSubject,\n  passwordResetEmailBody,\n};\n","// confirmationEmail\n//   subject\nconst confirmationEmailSubject = '{{siteName}} 账号确认';\n//   body\nconst confirmationEmailBody =\n`\n您好，{{userName}}，\n\n欢迎加入我们。请点击以下链接验证您的邮件：\n\n{{link}}\n\n此致，\n{{siteName}} 团队\n`;\n\n// passwordResetEmail\n//   subject\nconst passwordResetEmailSubject = '{{siteName}}重置密码';\n//   body\nconst passwordResetEmailBody =\n`\n您好，{{userName}}，\n\n请点击以下链接重置密码：\n\n{{link}}\n\n此致，\n{{siteName}} 团队\n`;\n\nmodule.exports = {\n  Close: '关闭',\n  'User/Password': '用户/密码',\n  'Authentication Failed': '认证失败',\n  'User is Disabled': '用户被禁用',\n  'Auth-Simple': '认证-简单',\n  'Reset Password': '重置密码',\n  'Element Exists': '元素已存在',\n  'Cannot Contain __': '不能包含__',\n  'Resend Confirmation Email': '重新发送确认邮件',\n  'Email Address does not Exist': '邮件地址不存在',\n  confirmationEmailExpired: '确认邮件链接已经过期',\n  confirmationEmailSucceeded: '您的邮件地址已经确认',\n  confirmationEmailSubject,\n  confirmationEmailBody,\n  passwordResetEmailExpired: '重置密码链接已经过期',\n  passwordResetEmailSubject,\n  passwordResetEmailBody,\n};\n","// error code should start from 1001\nmodule.exports = {\n  1001: 'Authentication Failed',\n  1002: 'User is Disabled',\n  1003: 'passwordResetEmailExpired',\n};\n","module.exports = app => {\n  // auth\n  const auth = require('./config/passport/auth.js')(app);\n  // keywords\n  const keywords = require('./config/validation/keywords.js')(app);\n  // schemas\n  const schemas = require('./config/validation/schemas.js')(app);\n  return {\n    auth,\n    validation: {\n      validators: {\n        signup: {\n          schemas: 'signup',\n        },\n        signin: {\n          schemas: 'signin',\n        },\n        passwordChange: {\n          schemas: 'passwordChange',\n        },\n        passwordForgot: {\n          schemas: 'passwordForgot',\n        },\n        passwordReset: {\n          schemas: 'passwordReset',\n        },\n        emailConfirm: {\n          schemas: 'emailConfirm',\n        },\n      },\n      keywords: {\n        'x-exists': keywords.exists,\n        'x-passwordForgotEmail': keywords.passwordForgotEmail,\n      },\n      schemas: {\n        signup: schemas.signup,\n        signin: schemas.signin,\n        passwordChange: schemas.passwordChange,\n        passwordForgot: schemas.passwordForgot,\n        passwordReset: schemas.passwordReset,\n        emailConfirm: schemas.emailConfirm,\n      },\n    },\n  };\n};\n","const strategy = require('./strategy.js');\nmodule.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const provider = moduleInfo.name;\n  async function verify(ctx, body) {\n    const { auth, password, rememberMe } = body;\n    // validate\n    await ctx.meta.validation.validate({ validator: 'signin', data: body });\n    // exists\n    const user = await ctx.meta.user.exists({ userName: auth, email: auth, mobile: auth });\n    if (!user) return ctx.throw(1001);\n    // disabled\n    if (user.disabled) return ctx.throw(1002);\n    // verify\n    const authSimple = await ctx.service.auth.verify({ userId: user.id, password });\n    if (!authSimple) return ctx.throw(1001);\n    return {\n      module: moduleInfo.relativeName,\n      provider,\n      profileId: authSimple.id,\n      maxAge: rememberMe ? null : 0,\n      authShouldExists: true,\n      profile: {\n        authSimpleId: authSimple.id,\n        rememberMe,\n      },\n    };\n  }\n  return {\n    providers: {\n      [provider]: {\n        meta: {\n          title: 'User/Password',\n          mode: 'direct',\n          component: 'signin',\n        },\n        config: {\n        },\n        handler: app => {\n          return {\n            strategy,\n            callback: (req, body, done) => {\n              verify(req.ctx, body).then(user => {\n                app.passport.doVerify(req, user, done);\n              }).catch(err => { done(err); });\n            },\n          };\n        },\n      },\n    },\n  };\n};\n","const passport = require('passport-strategy');\nconst util = require('util');\n\nfunction Strategy(options, verify) {\n  if (typeof options === 'function') {\n    verify = options;\n    options = {};\n  }\n  if (!verify) { throw new TypeError('LocalStrategy requires a verify callback'); }\n\n  passport.Strategy.call(this);\n  this.name = 'simple';\n  this._verify = verify;\n  this._passReqToCallback = options.passReqToCallback;\n}\n\n/**\n * Inherit from `passport.Strategy`.\n */\nutil.inherits(Strategy, passport.Strategy);\n\nStrategy.prototype.authenticate = function(req) {\n  // self\n  const self = this;\n\n  // check\n  if (req.method === 'GET') {\n    if (req.query.state === 'associate') {\n      // goto signup\n      let url = '/#!/a/authsimple/signup?state=associate';\n      if (req.query.returnTo) {\n        url = `${url}&returnTo=${encodeURIComponent(req.query.returnTo)}`;\n      }\n      url = req.ctx.meta.base.getAbsoluteUrl(url);\n      return self.redirect(url);\n    }\n    // not allow\n    return self.error(req.ctx.parseFail(403));\n  }\n\n  // verified\n  function verified(err, user, info) {\n    if (err) { return self.error(err); }\n    if (!user) { return self.fail(info); }\n    req.ctx.success(user);\n    self.success(user, info);\n  }\n\n  try {\n    if (self._passReqToCallback) {\n      this._verify(req, req.body, verified);\n    } else {\n      this._verify(req.body, verified);\n    }\n  } catch (ex) {\n    return self.error(ex);\n  }\n};\n\nmodule.exports = Strategy;\n","/**\n * Module dependencies.\n */\nvar Strategy = require('./strategy');\n\n\n/**\n * Expose `Strategy` directly from package.\n */\nexports = module.exports = Strategy;\n\n/**\n * Export constructors.\n */\nexports.Strategy = Strategy;\n","/**\n * Creates an instance of `Strategy`.\n *\n * @constructor\n * @api public\n */\nfunction Strategy() {\n}\n\n/**\n * Authenticate request.\n *\n * This function must be overridden by subclasses.  In abstract form, it always\n * throws an exception.\n *\n * @param {Object} req The request to authenticate.\n * @param {Object} [options] Strategy-specific options.\n * @api public\n */\nStrategy.prototype.authenticate = function(req, options) {\n  throw new Error('Strategy#authenticate must be overridden by subclass');\n};\n\n\n/**\n * Expose `Strategy`.\n */\nmodule.exports = Strategy;\n","module.exports = app => {\n  const keywords = {};\n  keywords.exists = {\n    async: true,\n    type: 'string',\n    errors: true,\n    compile() {\n      return async function(data, path, rootData, name) {\n        const ctx = this;\n        const res = await ctx.meta.user.exists({ [name]: data });\n        if (res && res.id !== ctx.user.agent.id) {\n          const errors = [{ keyword: 'x-exists', params: [], message: ctx.text('Element Exists') }];\n          throw new app.meta.ajv.ValidationError(errors);\n        }\n        if (!res && data.indexOf('__') > -1) {\n          const errors = [{ keyword: 'x-exists', params: [], message: ctx.text('Cannot Contain __') }];\n          throw new app.meta.ajv.ValidationError(errors);\n        }\n        return true;\n      };\n    },\n  };\n  keywords.passwordForgotEmail = {\n    async: true,\n    type: 'string',\n    errors: true,\n    compile() {\n      return async function(data, path, rootData, name) {\n        const ctx = this;\n        const res = await ctx.meta.user.exists({ [name]: data });\n        if (!res) {\n          const errors = [{ keyword: 'x-passwordForgotEmail', params: [], message: ctx.text('Email Address does not Exist') }];\n          throw new app.meta.ajv.ValidationError(errors);\n        }\n        return true;\n      };\n    },\n  };\n  return keywords;\n};\n","module.exports = app => {\n  const schemas = {};\n  schemas.signup = {\n    type: 'object',\n    properties: {\n      userName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Username',\n        notEmpty: true,\n        'x-exists': true,\n      },\n      realName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Realname',\n        notEmpty: true,\n      },\n      email: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Email',\n        notEmpty: true,\n        format: 'email',\n        'x-exists': true,\n      },\n      // mobile: {\n      //   type: 'string',\n      //   ebType: 'text',\n      //   ebTitle: 'Mobile',\n      //   notEmpty: true,\n      //   'x-exists': true,\n      // },\n      password: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Password',\n        ebSecure: true,\n        notEmpty: true,\n        minLength: 6,\n      },\n      passwordAgain: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Password Again',\n        ebSecure: true,\n        notEmpty: true,\n        const: { $data: '1/password' },\n      },\n    },\n  };\n  schemas.signin = {\n    type: 'object',\n    properties: {\n      auth: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Your Username/Mobile/Email',\n        notEmpty: true,\n      },\n      password: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Your Password',\n        ebSecure: true,\n        notEmpty: true,\n        minLength: 6,\n      },\n      rememberMe: {\n        type: 'boolean',\n        ebType: 'toggle',\n        ebTitle: 'Remember Me',\n      },\n    },\n  };\n  schemas.passwordChange = {\n    type: 'object',\n    properties: {\n      passwordOld: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Old Password',\n        ebSecure: true,\n        notEmpty: true,\n        minLength: 6,\n      },\n      passwordNew: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'New Password',\n        ebSecure: true,\n        notEmpty: true,\n        minLength: 6,\n      },\n      passwordNewAgain: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'New Password Again',\n        ebSecure: true,\n        notEmpty: true,\n        const: { $data: '1/passwordNew' },\n      },\n    },\n  };\n  schemas.emailConfirm = {\n    type: 'object',\n    properties: {\n      userName: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Username',\n        ebReadOnly: true,\n      },\n      email: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Email',\n        notEmpty: true,\n        format: 'email',\n        'x-exists': true,\n      },\n    },\n  };\n  schemas.passwordForgot = {\n    type: 'object',\n    properties: {\n      email: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'Email',\n        notEmpty: true,\n        format: 'email',\n        'x-passwordForgotEmail': true,\n      },\n    },\n  };\n  schemas.passwordReset = {\n    type: 'object',\n    properties: {\n      passwordNew: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'New Password',\n        ebSecure: true,\n        notEmpty: true,\n        minLength: 6,\n      },\n      passwordNewAgain: {\n        type: 'string',\n        ebType: 'text',\n        ebTitle: 'New Password Again',\n        ebSecure: true,\n        notEmpty: true,\n        const: { $data: '1/passwordNew' },\n      },\n    },\n  };\n  return schemas;\n};\n"],"sourceRoot":""}